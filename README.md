基于出租车GPS数据的时空特征提取及可视化项目

数据清洗模块：

纠正数据类型错误:
经过分析出租车GPS数据集，发现出租车GPS数据集中的时间(Timestamp)字段使用字符串(存储，这会导致在后续的分析中无法正常使用出租车GPS的时间戳宇段进行报作(如判断两个时间的大小关系等)，所以需要通过本楼块对其进行数据类型转换，通过读取字符申中的内容，将其转换为正确的时间戳 (Timestamp)数据类型。删除重复项:经过分析出租车GPS数据集，发现出租车GPS数据集中存在完全一样的GPS记录(包括时间、经纬度、出租车行驶方向、出租车行驶速度等关键数据)，本模块对这类数据进行识别井删除。

统一规格:系统使用的路网数据是由OpenStreetap获取的，使用的坐标系是国际通用的WGS-84坐标系(世界标准经纬度坐标系)，系统使用的出租车GPS数据采用的也是WGS-84坐标系，但是可视化部分中百度地图AP1采用的是BD-09坐标系，所以本模块将原始的WGS-84坐标系下的经纬度转换至BD-09坐标系下的经纬度，方面后面的数据可视化。

丢弃异常数据:经过分析出租车GPS数据集，发现有部分不能满足数据合法性的数据，如深圳市出租车的坐标在深圳市范围外、出租车速度始终为0(km/)、出租车平均速度超过城市道路的常规速度(120km/h)，出租车载客状态全天为“未载客”、出租车载客状本全天为“载客中”、关键数据(GPS时间、出租车经纬度、出租车载客状态等)的缺失。本模块将这类数据进行识别并删除



数据分析模块
为了了解城市交通认况及城市中出租车的大致运营现状，本模块需要分析出租车GPS数据，得出可以帮助研究人员更深入地理解城市交通与出租车运营现状的分析结果，从而更进一步改善城市交通与出租车运营。数据分析首先需要提取OD数据，即根据车辆载客状态，提取上客点与下客点，并将其——对应形成OD对,
数据分析模块主要包括;统计乘车需求的空间分布与时间分布、分析城市道路速度、统计出租车的载客率与乘客出行特征。通过将分析模块——可视化，可以使研究人员更的了解城市交通堵车的严重程度，从而更好地改进城市交通质量;也可以帮助研究人员以及出租车公司可以更好地调度出租车出行，从而使出租车司机极高寻找乘客的效率，最终提高出租车公司的经济效益，同时提高了乘客的乘车体验。

模块功能与输入输出:
提取OD数据:根据车辆教客状态，提取上客点与下客点，并将其——对应形成OD对。其输入数据为数据清洗与地图匹配后的出租车GPS数据。数据类型与数据清洗模块的输出数据类型一数。

字段名称	描述
O_COMMADDR	出租车id
O_time	上客点时间
O_lat	上客点纬度
O_Ing	上客点经度
O HEAD	上客点车辆方向
O SPEED	上客点车辆速度
O FLAG	上客点车辆状态
D_time	下客点时间
D_lat	下客点纬度
D_Ing	下客点经度
D_HEAD	下客点车辆方向
D SPEED	下客点车辆速度
D_FLAG	下客点车辆状态
OD TIME s	OD对的时间（秒）
OD_Dis km	OD对的距离（千米）
对上客点进行密度聚类：基于D8SCAN算法 ，对上客点进行密度聚类，提取热门上客区域，分析乘客需求的空间分布。（以10月12号一天的数据为例）其输入数据为提取OD数据的输出数据，聚类后的输出数据类型为（1012 heart.csv，作为“静态热门上客点查询”与“动态热力图”可视化的输入数据）：
字段名称	数据类型	是否为空	描述
lat	Double	否	热力中心点的纬度
Ing	Double	否	热力中心点的经度
count	Double	否	簇的热力值（上客的次数）
time	String	否	时间点
以固定的时间间隔统计乘客打车数量，分析乘客打车的时间分布。（每分钟，每15分钟，每小时的打车数量）其输入数据为提取OD数据的输出数据， 
字段名称	数据类型	是否为空	描述
O_time	String	否	时间段的起点时间
count	Int	否	上客数量

根据OD订单的起止时间与经纬度，计算订单的耗时与路程，结合订单的时段分布，分析乘客乘车的距离与时间分布。其输入数据为提取OD数据的输出数据，统计后的输出数据，作为“时间距离与耗时三维图”可视化的输入数据）：[订单耗时，订单时段，订单距离] 
根据OD订单的起止时间与经纬度，计算订单的平均速度
字段名称	数据类型	是否为空	描述
O_time	String	否	时间段的起点时间
sudu	Double	否	城市道路的平均速度（km/h）
将OD数据以1分钟的时间间隔进行升采样，统计载客出租车的数量。其输入数据为提取OD数据的输出数据，统计后的输出数据作为“载客数量变化图”可视化的输入数据
字段名称	数据类型	是否为空	描述 时间点
TIME	String	否	
number	Double	否	处于载客状态的出租车数量

根据OD订单的起止经纬度，计算订单的路程，并以4千与8千米为阈值划分出行订单的短途、中途、长途三种出行距离。其输入数据为提取OD数据的输出数据，统计后的输出数据类型为JNLuC.csv 
字段名称	数据类型	是否为空	描述
day	Int	否	日期的唯一标识
near	Int	否	近距离的订单数量
middle	Int	否	中距离的订单数量
far	Int	否	远距离的订单数量



数据可视化模块
可以查询规定时间段内所有车辆的GPS位置
某个车辆在某个时间段内的运行轨迹

数据分析模块的结果展示

静态热力图：以15分钟为间隔划分时间段，更新热力数据；能直观地观察济南出租车的热门载客区域，为出租车司机提供合理的寻客目标区域

动态热力图：黑色的点表示热力点的位置，点的大小表示热力值的强度。动态热力图的优势在于我们可以更加直观的看出客流量集散的时间分 时间与距离

载客车数量：以当前时段为起点，动态展示载客出租车的数量，载客出租车的数量相比于订单数量，更能展示城区内出租车的需求情况

路程分析：规定以小于四干米为短途，四干米至八干米为中途，大于八干米为长途，查看每天三种距离运输的占比

道路速度：利用中短途的订单数据中的预估距离与起止时间，计算订单的平均速度。虽然一个订单的平均速度并不能反映道路交通的拥堵状况， 



预测模块：
a. 乘客需求预测
问题描述：预测某个时间和地点的乘客需求（即是否会有乘客）。

特征：时间（小时）、地点（经纬度）、速度、历史载人状态等。
算法：时间序列预测（如ARIMA、LSTM）、回归模型（如线性回归、随机森林）。

b. ETA（预计到达时间）预测
问题描述：预测出租车从起点到终点的预计到达时间。
特征：起点和终点的经纬度、当前速度、历史路线时间。
算法：回归模型（如线性回归、XGBoost、深度学习模型等）。




附录
https://icode.best/i/17993015223395
百度地图api绘制出租车流向地图


DBSCAN算法：
DBSCAN（Density-Based Spatial Clustering of Applications with Noise）是一种基于密度的聚类算法，特别适用于发现任意形状的簇，并能有效处理噪声数据。以下是DBSCAN的基本概念和步骤：
基本概念
1.	Eps（ε）：指定半径，表示在该半径范围内的邻域。
2.	MinPts：指定邻域内的最小数据点数目，用于区分核心点。
3.	核心点（Core Point）：如果一个点在其Eps邻域内至少包含MinPts个数据点（包括自身），则该点是一个核心点。
4.	边界点（Border Point）：如果一个点不是核心点，但它在某个核心点的Eps邻域内，则该点是一个边界点。
5.	噪声点（Noise Point）：既不是核心点，也不是边界点的点，被视为噪声。
算法步骤
1.	选择一个未访问的数据点。
2.	找出该点的Eps邻域。
o	如果邻域内的点数不小于MinPts，则该点为核心点，并生成一个新的簇。否则，该点标记为噪声（稍后可能会被重新检查并归为边界点）。
3.	扩展簇：
o	对于每个核心点，将其邻域内的所有点添加到簇中，并对这些点进行检查，如果它们也是核心点，继续扩展簇。
4.	重复步骤1-3，直到所有点都被访问。
优点
1.	处理噪声：DBSCAN能够有效地识别和处理噪声点。
2.	任意形状的簇：能够发现任意形状的簇，而不仅限于球形簇。
3.	不需要预先指定簇的数量：不同于K-means，DBSCAN不需要事先指定簇的数量。
缺点
1.	参数敏感：算法对参数Eps和MinPts比较敏感，选择不当可能导致结果不理想。
2.	高维数据效果不佳：在高维空间中，数据点之间的距离变得相似，DBSCAN效果可能不佳。
3.	计算复杂度高：邻域搜索需要计算数据点之间的距离，对于大规模数据集，计算复杂度较高。
示例代码（使用Python的scikit-learn库）
python
复制代码
import numpy as np
import matplotlib.pyplot as plt
from sklearn.cluster import DBSCAN
from sklearn.datasets import make_blobs

# 生成示例数据
X, _ = make_blobs(n_samples=300, centers=4, cluster_std=0.5, random_state=0)

# 训练DBSCAN模型
db = DBSCAN(eps=0.3, min_samples=10).fit(X)

# 获取标签（簇）
labels = db.labels_

# 绘制结果
unique_labels = set(labels)
colors = [plt.cm.Spectral(each) for each in np.linspace(0, 1, len(unique_labels))]

for k, col in zip(unique_labels, colors):
    if k == -1:
        # 黑色用于噪声点
        col = [0, 0, 0, 1]

    class_member_mask = (labels == k)
    xy = X[class_member_mask]
    plt.plot(xy[:, 0], xy[:, 1], 'o', markerfacecolor=tuple(col), markeredgecolor='k', markersize=6)

plt.title('DBSCAN clustering')
plt.show()
参数解释
•	eps：指定每个点的邻域半径。
•	min_samples：指定邻域内的最小数据点数目，用于区分核心点。
总结
DBSCAN是一种强大的聚类算法，特别适用于处理具有噪声和任意形状的簇的数据集。然而，它对参数的选择比较敏感，且在高维数据中效果可能不佳。通过适当调整参数，DBSCAN能够在许多实际应用中表现出色。


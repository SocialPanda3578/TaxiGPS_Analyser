# TaxiGPS_Analyser

**当前进度:** 
- [ ] 数据清洗模块
    - [x]经纬度过滤
    - [x]速度过滤
    - [x]缺失值处理
    - [x]精细化去重
    - [x]异常状态切换检测
- [ ] 数据分析模块
    - [x] 提取OD数据
    - [ ] 对上客点进行密度聚类
    - [ ] 统计乘客打车数量时间分布
    - [ ] 分析乘客出行距离与时间分布
    - [ ] 分析城市道路平均速度
    - [ ] 统计载客出租车数量变化
    - [ ] 分析出行距离分布
- [ ] 数据可视化模块
    - [ ] 查询规定时间段内所有车辆的GPS位置
    - [ ] 某个车辆在某个时间段内的运行轨迹
    - [ ] 展示数据分析模块结果 (所有子项)
- [ ] 预测模块
    - [x] 乘客需求预测
    - [ ] ETA（预计到达时间）预测

## 🚀 项目模块与目标

### 1. 🛠️ 数据清洗模块 (Data Cleaning)

**目标:** 对原始出租车GPS数据进行预处理，提高数据质量，使其适用于后续的分析和可视化。

*   **[ ] 纠正数据类型错误 (Timestamp Parsing)**
    *   **描述:** 将原始数据中存储为字符串的 `Timestamp` 字段转换为标准的时间戳（`datetime`）数据类型。
    *   **实现:** 读取包含时间字符串的列，使用日期时间解析函数（如Python `datetime.strptime` 或 pandas `to_datetime`）进行转换。处理潜在的格式不一致或错误值。
    *   **完成标准:** 所有有效的Timestamp字符串都成功转换为datetime对象，无效的或无法解析的记录被标记或移除。
*   **[ ] 删除重复项 (Duplicate Removal)**
    *   **描述:** 识别并移除数据集中所有字段完全相同的冗余记录。
    *   **实现:** 对数据集按所有关键字段进行分组或排序，识别并丢弃具有完全相同值的行（如使用pandas `drop_duplicates`）。
    *   **完成标准:** 数据集中不存在完全重复的GPS记录。
*   **[ ] 统一规格 (Coordinate System Transformation)**
    *   **描述:** 将原始数据的WGS-84坐标系经纬度转换为百度地图API使用的BD-09坐标系经纬度，以便于可视化。
    *   **实现:** 实现或调用WGS-84到BD-09的坐标转换算法或库函数。对每条记录的经纬度字段进行转换，并新增或更新BD-09坐标字段。
    *   **完成标准:** 所有有效的WGS-84坐标都成功转换为对应的BD-09坐标。
*   **[ ] 丢弃异常数据 (Abnormal Data Filtering)**
    *   **描述:** 识别并移除不符合逻辑或合法性要求的数据记录。
    *   **实现:**
        *   实现地理位置检查，过滤掉坐标不在深圳市预定地理范围内的记录。
        *   识别并过滤掉速度异常的数据点（例如，速度 > 120 km/h）。
        *   分析车辆行驶轨迹，识别并标记或过滤掉速度长时间为0但状态显示为行驶中的异常记录。
        *   分析车辆的载客状态序列，识别并标记或过滤掉载客状态（FLAG）全天候异常（始终“未载客”或始终“载客中”）的车辆记录。
        *   识别并过滤掉关键字段（Timestamp, Lat, Lng, FLAG）缺失的记录。
    *   **完成标准:** 所有已知的异常数据类型已被识别并从数据集中移除或标记，输出符合基本数据合法性的数据集。

### 2. 📊 数据分析模块 (Data Analysis)

**目标:** 从清洗后的GPS数据中提取有价值的运营和交通模式信息，为可视化和预测提供输入。

*   **[ ] 提取OD数据 (Origin-Destination Extraction)**
    *   **描述:** 根据出租车的载客状态变化（从空车到载客为上车点O，从载客到空车为下车点D），识别并匹配形成OD对。
    *   **实现:** 遍历每辆出租车的按时间排序的GPS记录。查找 `FLAG` 从“未载客”变为“载客中”的点作为上车点(O)，从“载客中”变为“未载客”的点作为下车点(D)。将相邻的O和D匹配成一个OD对。计算OD对的持续时间(`OD_TIME_s`)和直线距离(`OD_Dis_km`)。
    *   **输入:** 数据清洗后的出租车GPS数据。
    *   **输出:** 结构化OD数据集，包含字段：`taxi_id`, `O_time`, `O_lat`, `O_lng`, ..., `D_flag`, `OD_TIME_s`, `OD_Dis_km`。
    *   **完成标准:** 成功识别并提取数据集中所有有效的OD对，并计算相关属性。
*   **[ ] 对上客点进行密度聚类 (DBSCAN Clustering on Pickup Points)**
    *   **描述:** 使用DBSCAN算法对提取出的上客点进行密度聚类，识别热门上客区域。可能需要按时间段进行聚类以支持动态热力图。
    *   **实现:**
        *   从OD数据中提取所有上客点 (`O_lat`, `O_lng`)。
        *   针对特定日期或时间段的数据，应用DBSCAN算法进行聚类。需要选择合适的`eps`和`min_samples`参数。
        *   对于每个聚类，计算其中心点（如所有点经纬度的平均值或核心点的平均值）作为热力点位置，并将簇的大小作为热力值(`count`)。
        *   为了支持动态热力图，需要按固定的时间间隔（如15分钟）对上客点数据进行切片，并对每个时间片执行聚类。
    *   **输入:** OD数据集 (`O_lat`, `O_lng`)。
    *   **输出:** 热门上客区域数据（每行代表一个热力中心），包含字段：`lat`, `lng` (BD-09坐标), `count`, `time` (表示该热力点所属的时间段，如"08:00-08:15")。
    *   **完成标准:** DBSCAN算法被成功实现或调用，能够对上客点进行聚类，并输出符合指定格式的热力点数据，支持按时间段生成。
*   **[ ] 统计乘客打车数量时间分布 (Pickup Count Time Distribution)**
    *   **描述:** 统计在不同时间间隔（每分钟、每15分钟、每小时）内的乘客打车数量（即OD数量），分析乘客需求的时间分布模式。
    *   **实现:** 根据OD数据中的上客时间(`O_time`)，将数据按分钟、15分钟、小时等时间粒度进行分组，并计算每组中的OD数量。
    *   **输入:** OD数据集 (`O_time`)。
    *   **输出:** 时间分布统计结果，包含字段：`O_time` (时间段的起始点), `count` (该时间段内的上客数量)。
    *   **完成标准:** 成功统计并生成按不同时间粒度的上客数量报告。
*   **[ ] 分析乘客出行距离与时间分布 (Trip Distance and Duration Analysis)**
    *   **描述:** 利用OD对的起止时间和经纬度计算的订单耗时和路程，结合订单的时段，分析乘客出行的距离和时间分布特征。
    *   **实现:** 从OD数据集中提取 `OD_TIME_s`、`OD_Dis_km` 和 `O_time`。可以将 `O_time` 转换为时间段（如小时）。生成一个数据集，每行代表一个OD订单，包含其耗时、距离和发生时段。进行汇总分析（如计算平均值、中位数、分位数，或按时间段/距离范围分组统计）。
    *   **输入:** OD数据集 (`OD_TIME_s`, `OD_Dis_km`, `O_time`)。
    *   **输出:** 可用于进一步分析和可视化的数据集/统计结果，包含字段：订单ID, `OD_TIME_s`, `OD_Dis_km`, 订单发生时段。以及可能的汇总统计报告。
    *   **完成标准:** 成功生成包含订单耗时、距离和时段的数据集，并能进行基本的统计分析。
*   **[ ] 分析城市道路平均速度 (Urban Road Average Speed Analysis)**
    *   **描述:** 利用OD订单数据（特别是中短途订单）计算订单的平均速度，并按时间段进行统计，以间接反映城市道路的平均通行速度。
    *   **实现:** 过滤出中短途（例如，距离 < 8km）的OD订单。计算每个订单的平均速度 (`OD_Dis_km` / `OD_TIME_s`，注意单位转换)。按时间段（如小时）对订单平均速度进行分组，计算每个时间段内的平均订单速度。
    *   **输入:** OD数据集 (`OD_TIME_s`, `OD_Dis_km`)。
    *   **输出:** 城市道路平均速度统计结果，包含字段：`O_time` (时间段的起始点), `sudu` (该时间段内的平均订单速度，km/h)。
    *   **完成标准:** 成功计算并生成按时间段划分的平均订单速度报告，过滤条件（中短途）得到应用。
*   **[ ] 统计载客出租车数量变化 (Loaded Taxi Count Time Series)**
    *   **描述:** 以固定的时间间隔（1分钟）统计处于载客状态的出租车数量变化，反映城区内出租车需求的实时动态。
    *   **实现:** 对清洗后的GPS数据进行处理。可以按1分钟间隔创建一个时间序列。对于每个时间点，统计在该时间点或其附近时间窗内，状态(`FLAG`)显示为“载客中”的唯一出租车ID数量。这可能需要插值或在时间窗内查找最近的记录。
    *   **输入:** 数据清洗后的出租车GPS数据 (`taxi_id`, `Timestamp`, `FLAG`)。
    *   **输出:** 载客出租车数量的时间序列数据，包含字段：`TIME` (时间点，1分钟间隔), `number` (该时间点处于载客状态的唯一出租车数量)。
    *   **完成标准:** 成功生成载客出租车数量的1分钟时间序列数据。
*   **[ ] 分析出行距离分布 (Trip Distance Distribution Analysis)**
    *   **描述:** 根据OD订单距离，将订单划分为短途（<4km）、中途（4km-8km）和长途（≥8km），统计每天不同距离订单的占比。
    *   **实现:** 从OD数据中提取 `OD_Dis_km`。对每个订单根据距离进行分类。按天对订单进行分组，统计每天短途、中途、长途订单的数量，并计算各自占比。
    *   **输入:** OD数据集 (`OD_Dis_km`, `O_time` 用于获取日期)。
    *   **输出:** 每天的出行距离分布统计结果，包含字段：`day`, `near` (短途数量), `middle` (中途数量), `far` (长途数量)。
    *   **完成标准:** 成功统计并生成每天的出行距离分布报告。

### 3. 📈 数据可视化模块 (Data Visualization)

**目标:** 以直观友好的方式展示出租车运营和交通分析结果，支持用户交互查询。使用百度地图API进行地理信息展示。

*   **[ ] 查询规定时间段内所有车辆的GPS位置 (Visualize All GPS Points)**
    *   **描述:** 实现一个界面，允许用户输入一个时间段，然后在地 图上显示该时间段内所有出租车的GPS点。
    *   **实现:** 开发前端界面（如网页应用）。实现后端接口，根据用户指定的时间段查询清洗后的GPS数据。前端使用百度地图API，将查询结果的点标记在地图上。
    *   **完成标准:** 用户能成功输入时间段，地图上能正确显示该时间段内的所有GPS点。
*   **[ ] 某个车辆在某个时间段内的运行轨迹 (Visualize Single Trajectory)**
    *   **描述:** 实现一个界面，允许用户输入车辆ID和一个时间段，然后在地 图上绘制该车辆在该时间段内的运行轨迹。
    *   **实现:** 开发前端界面。实现后端接口，根据用户指定的车辆ID和时间段查询清洗后的GPS数据。前端使用百度地图API，将查询结果的点按时间顺序连接起来绘制成轨迹线。可以在轨迹点上显示信息（如时间、速度、状态）。
    *   **完成标准:** 用户能成功查询指定车辆在指定时间段内的轨迹，并在地图上正确绘制。
*   **[ ] 展示数据分析模块结果 (Visualize Analysis Results)**
    *   **描述:** 将数据分析模块产生的各种统计和分析结果进行可视化展示。
    *   **实现:** 为以下各项分析结果开发对应的可视化界面和图表：
        *   **[ ] 静态热力图 (Static Heatmap)**: 使用聚类分析产生的热力点数据（按时间段生成），在百度地图上叠加热力图层。允许用户选择特定的时间段进行查看。
        *   **[ ] 动态热力图 (Dynamic Heatmap)**: 基于按时间段生成的系列热力点数据，实现一个带有时间播放/滑动功能的界面，动态展示不同时间段内的热门上客区域（通过改变热力点大小/颜色强度）。
        *   **[ ] 时间距离与耗时关系图 (Time-Distance-Duration Plot)**: 使用分析模块输出的订单耗时、距离、时段数据，生成散点图或3D图，展示三者关系。
        *   **[ ] 载客车数量变化图 (Loaded Taxi Count Chart)**: 使用载客车数量时间序列数据，生成折线图或区域图，展示载客车辆数随时间的变化。可能需要实现动态更新效果。
        *   **[ ] 路程分析饼/柱状图 (Trip Distance Distribution Chart)**: 使用出行距离分布统计结果，生成饼图或柱状图，展示每天不同距离订单类型的占比。
        *   **[ ] 道路平均速度变化图 (Road Speed Chart)**: 使用城市道路平均速度统计结果，生成折线图，展示按时间段划分的平均订单速度变化。
    *   **完成标准:** 所有主要的数据分析结果都能通过相应的图表或地图叠加层直观地展示，并支持用户交互（如选择时间段）。

### 4. 🔮 预测模块 (Prediction)

**目标:** 基于历史数据构建模型，预测未来的乘客需求和ETA。

*   **[ ] 乘客需求预测 (Passenger Demand Prediction)**
    *   **问题:** 预测特定时间和地点（区域网格或POI附近）的乘客需求量（如未来15分钟内该区域的可能上客数量）。
    *   **实现:**
        *   **数据准备:** 构建特征数据集，包括时间特征（小时、星期几、节假日等）、空间特征（经纬度、区域ID）、历史需求特征（同一区域/时间的历史需求统计）、以及可能的外部特征（天气等）。
        *   **模型选择与训练:** 选择并实现时间序列模型（ARIMA, LSTM）或回归模型（线性回归, 随机森林, GBDT, XGBoost等）。使用历史数据训练模型。
        *   **评估:** 使用交叉验证和合适的评估指标（如RMSE, MAE）评估模型性能。
    *   **输入:** 清洗后的GPS数据、OD数据，可能的外部数据。
    *   **输出:** 训练好的乘客需求预测模型，能够接收时间和地点作为输入，输出预测的需求值。
    *   **完成标准:** 构建至少一种有效的预测模型，并达到可接受的预测精度。
*   **[ ] ETA（预计到达时间）预测 (Estimated Time of Arrival Prediction)**
    *   **问题:** 预测出租车从给定起点到给定终点的预计行驶时间。
    *   **实现:**
        *   **数据准备:** 构建特征数据集，包括起点和终点坐标、行驶距离、历史在该路径或类似路径上的行驶时间、当前时间、实时交通信息（如果可获得）、出租车当前速度等。可能需要利用地图匹配结果或路网数据。
        *   **模型选择与训练:** 选择并实现回归模型（线性回归, XGBoost, 深度学习模型如RNN/LSTM）。使用历史OD数据及对应的实际行驶时间进行训练。
        *   **评估:** 使用交叉验证和合适的评估指标（如RMSE, MAE）评估模型性能。
    *   **输入:** OD数据，可能的地图匹配数据、路网数据。
    *   **输出:** 训练好的ETA预测模型，能够接收起止点和当前时间等作为输入，输出预测的行驶时间。
    *   **完成标准:** 构建至少一种有效的ETA预测模型，并达到可接受的预测精度。

## 📝 附录（技术参考）

*   **DBSCAN算法:** 已提供的DBSCAN算法原理和Scikit-learn示例代码将作为实现密度聚类时的重要参考。
*   **百度地图API:** 用于实现数据可视化模块中的地图展示、点标记、轨迹绘制和热力图叠加功能。参考提供的API链接或官方文档。
*   **坐标转换算法:** 需要实现WGS-84到BD-09的精确转换算法。
*   **距离计算:** 使用Haversine公式或类似的球面距离算法计算经纬度点之间的距离。

